name: Build Android APK

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Fix app structure
      run: |
        echo "üîß –ò—Å–ø—Ä–∞–≤–ª—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–∞–ø–æ–∫..."
        
        # –°–æ–∑–¥–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É
        mkdir -p app/src/main/res/values
        mkdir -p app/src/main/res/layout
        
        # –ü–µ—Ä–µ–º–µ—â–∞–µ–º —Ñ–∞–π–ª—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–∞–ø–∫–∏
        if [ -f "app/src/main/res_values/strings.xml" ]; then
          mv "app/src/main/res_values/strings.xml" "app/src/main/res/values/strings.xml"
        fi
        
        if [ -f "app/src/main/res/layout/activity_main.xml" ]; then
          mv "app/src/main/res/layout/activity_main.xml" "app/src/main/res/layout/activity_main.xml"
        fi
        
        # –£–¥–∞–ª—è–µ–º –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—É—é –ø–∞–ø–∫—É
        rm -rf app/src/main/res_values
        
        echo "‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞"
      
    - name: Check final structure
      run: |
        echo "üìÅ –§–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:"
        find app/ -type f -name "*.xml" -o -name "*.java" -o -name "*.kt" | sort
        echo ""
        echo "üìã –ü–∞–ø–∫–∏:"
        tree app/ || find app/ -type d | sort
      
    - name: Setup Android SDK
      uses: android-actions/setup-android@v3
      with:
        api-level: 34
        build-tools: 34.0.0
        
    - name: Try simple build
      run: |
        cd app
        echo "üîß –ü–æ–ø—ã—Ç–∫–∞ –ø—Ä–æ—Å—Ç–æ–π —Å–±–æ—Ä–∫–∏..."
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –≤—Å–µ —Ñ–∞–π–ª—ã –Ω–∞ –º–µ—Å—Ç–µ
        if [ -f "src/main/AndroidManifest.xml" ] && \
           [ -f "src/main/res/values/strings.xml" ] && \
           [ -f "src/main/res/layout/activity_main.xml" ]; then
          echo "‚úÖ –í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ–∞–π–ª—ã –Ω–∞–π–¥–µ–Ω—ã!"
          echo "üì± –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∫ —Å–±–æ—Ä–∫–µ"
        else
          echo "‚ùå –ù–µ –≤—Å–µ —Ñ–∞–π–ª—ã –Ω–∞–π–¥–µ–Ω—ã"
          find . -name "*.xml" -o -name "*.java" -o -name "*.kt"
        fi
