name: Build Internet Provider App

on:
  push:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup JDK
      uses: actions/setup-java@v4
      with:
        distribution: 'temurin'
        java-version: '17'
    
    - name: Setup Android SDK
      uses: android-actions/setup-android@v2
      
    - name: Install Android packages
      run: |
        yes | $ANDROID_HOME/cmdline-tools/latest/bin/sdkmanager --install "platforms;android-34" "build-tools;34.0.0"
    
    - name: Create project files
      run: |
        # Create directory structure
        mkdir -p app/src/main/java/com/example/internetprovider
        mkdir -p app/src/main/res/layout
        mkdir -p app/src/main/res/values
        
        # Create AndroidManifest.xml
        echo '<?xml version="1.0" encoding="utf-8"?>' > app/src/main/AndroidManifest.xml
        echo '<manifest xmlns:android="http://schemas.android.com/apk/res/android"' >> app/src/main/AndroidManifest.xml
        echo '    package="com.example.internetprovider">' >> app/src/main/AndroidManifest.xml
        echo '    <uses-permission android:name="android.permission.INTERNET" />' >> app/src/main/AndroidManifest.xml
        echo '    <application android:label="Интернет Провайдер" android:theme="@android:style/Theme.Material.Light">' >> app/src/main/AndroidManifest.xml
        echo '        <activity android:name=".MainActivity" android:exported="true">' >> app/src/main/AndroidManifest.xml
        echo '            <intent-filter>' >> app/src/main/AndroidManifest.xml
        echo '                <action android:name="android.intent.action.MAIN" />' >> app/src/main/AndroidManifest.xml
        echo '                <category android:name="android.intent.category.LAUNCHER" />' >> app/src/main/AndroidManifest.xml
        echo '            </intent-filter>' >> app/src/main/AndroidManifest.xml
        echo '        </activity>' >> app/src/main/AndroidManifest.xml
        echo '    </application>' >> app/src/main/AndroidManifest.xml
        echo '</manifest>' >> app/src/main/AndroidManifest.xml
        
        # Create strings.xml
        echo '<?xml version="1.0" encoding="utf-8"?>' > app/src/main/res/values/strings.xml
        echo '<resources>' >> app/src/main/res/values/strings.xml
        echo '    <string name="app_name">Интернет Провайдер</string>' >> app/src/main/res/values/strings.xml
        echo '</resources>' >> app/src/main/res/values/strings.xml
        
        # Create MainActivity.java
        echo 'package com.example.internetprovider;' > app/src/main/java/com/example/internetprovider/MainActivity.java
        echo 'import android.app.Activity;' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo 'import android.content.Intent;' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo 'import android.net.Uri;' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo 'import android.os.Bundle;' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo 'import android.view.View;' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo 'import android.widget.Button;' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo 'import android.widget.LinearLayout;' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo 'import android.widget.ScrollView;' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo 'import android.widget.TextView;' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo 'public class MainActivity extends Activity {' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '    @Override' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '    protected void onCreate(Bundle savedInstanceState) {' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '        super.onCreate(savedInstanceState);' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '        createUI();' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '    }' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '    private void createUI() {' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '        ScrollView scrollView = new ScrollView(this);' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '        LinearLayout mainLayout = new LinearLayout(this);' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '        mainLayout.setOrientation(LinearLayout.VERTICAL);' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '        mainLayout.setPadding(50, 50, 50, 50);' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '        // Заголовок' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '        TextView title = new TextView(this);' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '        title.setText("Интернет Провайдер");' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '        title.setTextSize(24);' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '        mainLayout.addView(title);' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '        // Раздел Тарифы' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '        addSection(mainLayout, "Тарифы");' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '        addTariff(mainLayout, "Частный сектор", "• Скорость: 100 Мбит/с\\n• Цена: 500 руб/мес\\n• Безлимитный трафик");' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '        addTariff(mainLayout, "Многоквартирный дом", "• Скорость: 200 Мбит/с\\n• Цена: 700 руб/мес\\n• IP-TV в подарок");' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '        addTariff(mainLayout, "Юридические лица", "• Скорость: 500 Мбит/с\\n• Цена: 2000 руб/мес\\n• Статический IP\\n• Приоритетное обслуживание");' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '        // Раздел Контакты' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '        addSection(mainLayout, "Контакты");' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '        addContact(mainLayout, "Телефон", "+7 (123) 456-78-90");' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '        addContact(mainLayout, "Email", "support@provider.ru");' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '        addContact(mainLayout, "Адрес", "г. Москва, ул. Примерная, д. 1");' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '        // Кнопка оплаты' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '        Button payButton = new Button(this);' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '        payButton.setText("Оплатить через Payberry");' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '        payButton.setOnClickListener(new View.OnClickListener() {' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '            @Override' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '            public void onClick(View v) {' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '                Intent browserIntent = new Intent(Intent.ACTION_VIEW, Uri.parse("https://payberry.ru"));' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '                startActivity(browserIntent);' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '            }' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '        });' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '        mainLayout.addView(payButton);' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '        scrollView.addView(mainLayout);' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '        setContentView(scrollView);' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '    }' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '    private void addSection(LinearLayout layout, String text) {' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '        TextView section = new TextView(this);' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '        section.setText(text);' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '        section.setTextSize(20);' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '        section.setPadding(0, 30, 0, 10);' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '        layout.addView(section);' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '    }' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '    private void addTariff(LinearLayout layout, String title, String details) {' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '        TextView tariff = new TextView(this);' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '        tariff.setText(title + "\\n" + details);' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '        tariff.setPadding(20, 10, 20, 20);' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '        tariff.setBackgroundColor(0xFFE3F2FD);' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '        layout.addView(tariff);' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '    }' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '    private void addContact(LinearLayout layout, String type, String value) {' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '        TextView contact = new TextView(this);' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '        contact.setText(type + ": " + value);' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '        contact.setPadding(10, 5, 10, 5);' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '        layout.addView(contact);' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '    }' >> app/src/main/java/com/example/internetprovider/MainActivity.java
        echo '}' >> app/src/main/java/com/example/internetprovider/MainActivity.java
    
    - name: Build APK
      run: |
        cd app
        keytool -genkey -v -keystore debug.keystore -storepass android -alias androiddebugkey -keypass android -keyalg RSA -keysize 2048 -validity 10000 -dname "CN=Android Debug,O=Android,C=US"
        mkdir -p build/classes build/dex
        javac -d build/classes -cp $ANDROID_HOME/platforms/android-34/android.jar src/main/java/com/example/internetprovider/MainActivity.java
        $ANDROID_HOME/build-tools/34.0.0/d8 --lib $ANDROID_HOME/platforms/android-34/android.jar --output build/dex/ build/classes/com/example/internetprovider/*.class
        $ANDROID_HOME/build-tools/34.0.0/aapt package -M src/main/AndroidManifest.xml -I $ANDROID_HOME/platforms/android-34/android.jar -F build/app-unsigned.apk -f
        cd build
        zip -uj app-unsigned.apk dex/classes.dex
        cd ..
        $ANDROID_HOME/build-tools/34.0.0/apksigner sign --ks debug.keystore --ks-pass pass:android --key-pass pass:android --out build/app-debug.apk build/app-unsigned.apk
        ls -la build/app-debug.apk
      
    - name: Upload APK
      uses: actions/upload-artifact@v4
      with:
        name: internet-provider-app
        path: app/build/app-debug.apk
